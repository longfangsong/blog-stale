---
title: js解混淆
date: 2018-04-13 00:00:00
tags: [Javascript]
mathjax: true
comments: true
summary: 网上很多js都是加密混淆过的，这对我们研究这些js的内部实现不利，但是我们有一个很简单的办法就能破解这里的混淆。
---
<p>假设有这么一段js：</p>
 hexo-inject:begin  hexo-inject:end <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">str</span>) </span>{</span><br/><span class="line">    alert(str);</span><br/><span class="line">    <span class="built_in">console</span>.log(str);</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<p>我们用常见的加密混淆工具，能得到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">p,a,c,k,e,d</span>)</span>{e=<span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>{<span class="keyword">return</span>(c&lt;a?<span class="string">""</span>:e(<span class="built_in">parseInt</span>(c/a)))+((c=c%a)&gt;<span class="number">35</span>?<span class="built_in">String</span>.fromCharCode(c+<span class="number">29</span>):c.toString(<span class="number">36</span>))};<span class="keyword">if</span>(!<span class="string">''</span>.replace(<span class="regexp">/^/</span>,<span class="built_in">String</span>)){<span class="keyword">while</span>(c--)d[e(c)]=k[c]||e(c);k=[<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>{<span class="keyword">return</span> d[e]}];e=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{<span class="keyword">return</span><span class="string">'\\w+'</span>};c=<span class="number">1</span>;};<span class="keyword">while</span>(c--)<span class="keyword">if</span>(k[c])p=p.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\b'</span>+e(c)+<span class="string">'\\b'</span>,<span class="string">'g'</span>),k[c]);<span class="keyword">return</span> p;}(<span class="string">'2 1(0){3(0);5.4(0)}'</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="string">'str|say|function|alert|log|console'</span>.split(<span class="string">'|'</span>),<span class="number">0</span>,{}))</span><br/></pre></td></tr></table></figure>
<p>完全理解不能，那怎么办呢？</p>
<p>注意到这里是使用<code>eval</code>函数来运行里面这个函数返回的字符串，而我们只要在<code>eval</code>这个函数上做些文章，就能获取到“里面这个函数返回的字符串”，就能看到原来的代码了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _eval = <span class="built_in">eval</span>;</span><br/><span class="line"><span class="built_in">eval</span>=<span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>{</span><br/><span class="line">	<span class="built_in">console</span>.log(s);	<span class="comment">// 输出他的解密后的代码</span></span><br/><span class="line">	<span class="comment">// _eval(s);	// 若不止要读到解密后代码，还需要执行，解开此处注释</span></span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">eval</span>(<span class="keyword">function</span>(p,a,c,k,e,d){e=<span class="keyword">function</span>(c){<span class="built_in">return</span>(c&lt;a?<span class="string">""</span>:e(parseInt(c/a)))+((c=c%a)&gt;35?String.fromCharCode(c+29):c.toString(36))};<span class="keyword">if</span>(!<span class="string">''</span>.replace(/^/,String)){<span class="keyword">while</span>(c--)d[e(c)]=k[c]||e(c);k=[<span class="keyword">function</span>(e){<span class="built_in">return</span> d[e]}];e=<span class="function"><span class="title">function</span></span>(){<span class="built_in">return</span><span class="string">'\\w+'</span>};c=1;};<span class="keyword">while</span>(c--)<span class="keyword">if</span>(k[c])p=p.replace(new RegExp(<span class="string">'\\b'</span>+e(c)+<span class="string">'\\b'</span>,<span class="string">'g'</span>),k[c]);<span class="built_in">return</span> p;}(<span class="string">'2 1(0){3(0);5.4(0)}'</span>,6,6,<span class="string">'str|say|function|alert|log|console'</span>.split(<span class="string">'|'</span>),0,{}))</span></span><br/><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">function</span> say(str){alert(str);console.log(str)}</span></span><br/></pre></td></tr></table></figure>
<p>我们的代码回来了。</p>

